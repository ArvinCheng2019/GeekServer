# GeekProto
### 特点
基于MessagePack，序列化和反序列化效率极高，同时序列化之后的数据极小，数据传输效率很高。[MessagePack-CSharp](https://github.com/neuecc/MessagePack-CSharp) 【Super Fast Binary Serialization Library】  

### 定义方式
```csharp
/// <summary>
/// 请求登录
/// </summary>
[MessagePackObject]
[Serialize(111001)]
public class ReqLogin : Message
{
    [Key(1)]
    public string UserName { get; set; }
    [Key(2)]
    public string Platform { get; set; }
    [Key(3)]
    public int SdkType { get; set; }
    [Key(4)]
    public string SdkToken { get; set; }
    [Key(5)]
    public string Device { get; set; }
}

```
1.Serialize注解，用于为每个可序列化类分配唯一ID，不用担心ID被重复使用，重复时生成的代码会报错。  
2.MessagePackObject注解，所有需要序列化的类都要标记  
3.Key注解，用于标记需要序列化的字段和顺序  
4.仅作为消息头的类需要继承自Message，其他不用  
5.**请勿将协议中的类，存入State中（为支持协议的热更新）**

### 限制
兼容限制：字段只能添加，添加后不能删除，添加字段只能添加到最后,过期字段可添加Obsolete  
兼容限制：不能修改字段类型（如从bool改为long）  
[了解更多 MessagePack-CSharp](https://github.com/neuecc/MessagePack-CSharp)  

### 多态支持

MessagePack对多态支持不用好，Geek.MessagePackTool工具会在代码生成时，生成多态绑定关系，用户需要做的就是为每个序列化类分配一个序列化id（用Serialize注解分配）

```csharp
public partial class PolymorphicRegister
{
    static PolymorphicRegister()
    {
        System.Console.WriteLine("***PolymorphicRegister Init***");
		Init();
        Register();
    }

	public static void Register()
    {
		settings.RegisterType<Geek.Server.Message, Geek.Server.Proto.ReqBagInfo>(112001);
		settings.RegisterType<Geek.Server.Message, Geek.Server.Proto.ResBagInfo>(112002);
		settings.RegisterType<Geek.Server.Message, Geek.Server.Proto.ReqUseItem>(112003);
		settings.RegisterType<Geek.Server.Message, Geek.Server.Proto.ReqSellItem>(112004);
		settings.RegisterType<Geek.Server.Message, Geek.Server.Proto.ResItemChange>(112005);
		settings.RegisterType<Geek.Server.Proto.A, Geek.Server.Proto.B>(111112);
		settings.RegisterType<Geek.Server.Message, Geek.Server.Proto.ReqLogin>(111001);
		settings.RegisterType<Geek.Server.Message, Geek.Server.Proto.ResLogin>(111002);
		settings.RegisterType<Geek.Server.Message, Geek.Server.Proto.ResLevelUp>(111003);
		settings.RegisterType<Geek.Server.Message, Geek.Server.Proto.HearBeat>(111004);
		settings.RegisterType<Geek.Server.Message, Geek.Server.Proto.ResErrorCode>(111005);
    }
}
```

### 最佳实践
1.可以将Geek.MessagePackTool.exe添加到vs studio的外部工具  
![](https://github.com/leeveel/GeekServer/blob/main/Docs/imgs/vs001.png)
![](https://github.com/leeveel/GeekServer/blob/main/Docs/imgs/vs002.png)  
2.GeekProto工作仅需要依赖GeekProto工程，所以其他工程编译不过时，不影响导出协议